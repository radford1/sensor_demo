<!doctype html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<button id="start">Start streaming</button>
<script>
const URL = "https://your.api/accel";   // <-- change me
const intervalMs = 100;
let last = 0;
console.log("here")
document.getElementById('start').addEventListener('click', async () => {
  try {
    if (typeof DeviceMotionEvent?.requestPermission === 'function') {
      const ok = await DeviceMotionEvent.requestPermission();
      if (ok !== 'granted') { alert('Motion permission denied'); return; }
    }
    window.addEventListener('devicemotion', (e) => {
      const now = performance.now();
      if (now - last < intervalMs) return; last = now;

      // acceleration may be null on some devices; includingGravity is more reliable in Safari
      const a = e.acceleration ?? e.accelerationIncludingGravity;
      if (!a) return;

      const payload = { ts: Date.now()/1000, x: a.x, y: a.y, z: a.z };
      fetch(URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      }).catch(()=>{});
    }, { passive: true });
  } catch (err) {
    console.error(err); alert(String(err));
  }
});
</script>
